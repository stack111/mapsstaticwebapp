<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>Vanilla JavaScript App</title>
  <link rel="stylesheet" href="https://us.atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css"
  type="text/css" />
  <script src="https://us.atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>
</head>

<body>
  <main>
    <h1>Vanilla JavaScript App</h1>
    <div id="map" style="width: 100%; height: 600px"></div>
  </main>
  <script>
    (async function () {
      atlas.setDomain('us.atlas.microsoft.com');
      const { sasToken } = await (await fetch(`/api/mapsfunc`)).json();

      // load the map after we fetch the sas token.
      var map = new atlas.Map("map", {
          center: [-122.33, 47.64],
          zoom: 12,
          language: "en-US",
          authOptions: {
              authType: "subscriptionKey",
              subscriptionKey: sasToken
          }
      });      
    }())
  </script>
</body>

</html>